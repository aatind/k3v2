apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: traefik
  namespace: kube-system
spec:
  chart: traefik
  repo: https://helm.traefik.io/traefik
  targetNamespace: traefik
  valuesContent: |-
    certResolvers:
      letsencrypt:
        email: "info@systechit.dk"
        httpChallenge:
          entryPoint: "web"
        # match the path to persistence
        storage: /data/acme.json

    # Allow externalnameservices
    providers:
      kubernetesIngress:
        allowExternalNamServices: "true"
      kubernetesCRD:
        allowExternalNameServices: "true"

    ports:
    # Configure your entrypoints here...
        web:
        # (optional) Permanent Redirect to HTTPS
            redirectTo: websecure
        websecure:
        tls:
            enabled: true   

    # Disable Dashboard
    ingressRoute:
        dashboard:
          enabled: false

    # Persistent Storage
    persistence:
        enabled: true

    # Set Traefik as your default Ingress Controller, according to Kubernetes 1.19+ changes.
    ingressClass:
        enabled: true
        isDefaultClass: true
    
    service:
      loadBalancerSourceRanges: 
        - 192.168.31.40/32
